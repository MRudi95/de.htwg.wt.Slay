@(ctrl: SlayController, message: String)

@import de.htwg.se.slay.model.gamepieceComponent.NoPiece
@import de.htwg.se.slay.model.gamepieceComponent.Tree
@import de.htwg.se.slay.model.gamepieceComponent.Grave
@import de.htwg.se.slay.model.gamepieceComponent.Castle
@import de.htwg.se.slay.model.gamepieceComponent.Knight
@import de.htwg.se.slay.model.gamepieceComponent.Capital
@import de.htwg.se.slay.model.gamepieceComponent.Peasant
@import de.htwg.se.slay.model.gamepieceComponent.Baron
@import de.htwg.se.slay.model.gamepieceComponent.Spearman

@cell(idx: Int) = {
    @ctrl.gameController.grid(idx).owner match {
        case x if ctrl.gameController.players(0) == x => {
            <td class="cellP0 border border-light clickable"/>
        }
        case x if ctrl.gameController.players(1) == x => {
            <td class="cellP1 border border-light clickable"/>
        }
        case x if ctrl.gameController.players(2) == x => {
            <td class="cellP2 border border-light clickable"/>
        }
        case _ => {
        }
    }
}

@gamePiece(idx: Int) = {
    @ctrl.gameController.grid(idx).gamepiece match {
        case _:NoPiece  => {}
        case _:Tree     => { <img src=@routes.Assets.versioned("images/tree.png")> }
        case _:Grave    => { <img src=@routes.Assets.versioned("images/grave.png")> }
        case _:Capital  => { <img src=@routes.Assets.versioned("images/capital.png")> }
        case _:Castle   => { <img src=@routes.Assets.versioned("images/castle.png")> }
        case _:Peasant  => { <img src=@routes.Assets.versioned("images/peasant.gif")> }
        case _:Spearman => { <img src=@routes.Assets.versioned("images/spearman.gif")> }
        case _:Knight   => { <img src=@routes.Assets.versioned("images/knight.gif")> }
        case _:Baron    => { <img src=@routes.Assets.versioned("images/baron.gif")> }
        case _ => {}
    }
}

@cellIndex(rows: Int, cols: Int) = @{
    rows * (ctrl.gameController.grid.colIdx+1) + cols
}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Slay Game</title>
        <link rel="stylesheet" href='@routes.Assets.versioned("stylesheets/main.css")'>
        <link rel="stylesheet" href='@routes.Assets.versioned("stylesheets/bootstrap.min.css")'>
        <script src="@routes.Assets.versioned("javascripts/jquery-3.4.1.min.js")" ></script>
    </head>
    <body class="bg-secondary">
        <script>
            // number to corresponding letter
            function letter(l) {
                switch (l) {
                    case 1: return 'A';
                    case 2: return 'B';
                    case 3: return 'C';
                    case 4: return 'D';
                    case 5: return 'E';
                    case 6: return 'F';
                    case 7: return 'G';
                    case 8: return 'H';
                    case 9: return 'I';
                    case 10: return 'J';
                    case 11: return 'K';
                    case 12: return 'L';
                    case 13: return 'M';
                    case 14: return 'N';
                    case 15: return 'O';
                    case 16: return 'P';
                    case 17: return 'Q';
                    case 18: return 'R';
                    case 19: return 'S';
                    case 20: return 'T';
                    case 21: return 'U';
                    case 22: return 'V';
                    case 23: return 'W';
                    case 24: return 'X';
                    case 25: return 'Y';
                    default: return 'Z';
                }
            }

            // bools for commands to check
            let coord0set = coord1set = false;

            $(function() {
                // Hide coord buttons on start
                $('.coordButton').hide();

                // Coord selection by clicking on game table
                $('.clickable').click(function(){
                    if (!coord0set) {
                        $('#coord0').text(letter(this.cellIndex) + this.parentNode.rowIndex);
                        $('#coord0').show();
                        coord0set = true;
                    } else if (!coord1set) {
                        $('#coord1').text(letter(this.cellIndex) + this.parentNode.rowIndex);
                        $('#coord1').show();
                        coord1set = true;
                    } else {
                        $('#coord0').text(letter(this.cellIndex) + this.parentNode.rowIndex);
                        $('#coord0').show();
                        coord0set = true;
                        $('#coord1').hide();
                        coord1set = false;
                    }
                    if ($('#coord0').text() == $('#coord1').text()) {
                        $('#coord1').hide();
                        coord1set = false;
                    }
                });

                // Deselect the coord buttons
                $('#coord0').click(function(){
                    $(this).hide();
                    coord0set = false;
                })
                $('#coord1').click(function(){
                    $(this).hide();
                    coord1set = false;
                })

                // Command buttons
                $('#buyBtn').click(function() {
                    if (coord0set && !coord1set) {
                        window.location = '/buy/' + $('#coord0').text();
                    }
                })
                $('#combineBtn').click(function() {
                    if (coord0set && coord1set) {
                        window.location = '/cmb/' + $('#coord0').text() + '/' + $('#coord1').text();
                    }
                })
                $('#moveBtn').click(function() {
                    if (coord0set && coord1set) {
                        window.location = '/mov/' + $('#coord0').text() + '/' + $('#coord1').text();
                    }
                })
                $('#castleBtn').click(function() {
                    if (coord0set && !coord1set) {
                        window.location = '/plc/' + $('#coord0').text();
                    }
                })
                $('#balanceBtn').click(function() {
                    if (coord0set && !coord1set) {
                        window.location = '/bal/' + $('#coord0').text();
                    }
                })
                $('#endTurnBtn').click(function() {
                    window.location = '/end';
                })
                $('#surrenderBtn').click(function() {
                    if (confirm('Are you sure you want to surrender?')) {
                        window.location = '/ff20'
                    }
                })

            });
        </script>

        <nav class="navbar navbar-expand navbar-dark bg-dark">
            <a class="navbar-brand" href="">HTWG Slay</a>

            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="/about">About</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/undo">Undo</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/redo">Redo</a>
                </li>
            </ul>

            <ul class="navbar-nav">
                <li>
                    <a class="nav-link" href="http://www.windowsgames.co.uk/slay.html">Original</a>
                </li>
                <li>
                    <a class="nav-link" href="https://github.com/MRudi95/de.htwg.wt.Slay">GitHub</a>
                </li>
            </ul>
        </nav>


        <div class="pagecontainer">
            <table id="gameTable">
                <thead/>
                <tr class="gameIndexes bg-dark"/>
                <td/>
                @for(i <- 0 to ctrl.gameController.grid.colIdx){
                    <td/> @{var char = 65; char+= i; char.toChar}
                }
                <tbody>
                @for(rows <- 0 to ctrl.gameController.grid.rowIdx){
                    <tr/>
                    <td class="gameIndexes bg-dark"/> @(rows+1)
                    @for(cols <- 0 to ctrl.gameController.grid.colIdx){
                        @cell(cellIndex(rows, cols))
                        <div class="gamePiece"/> @gamePiece(cellIndex(rows, cols))
                    }
                }
                </tbody>
            </table>

            <div class="d-flex justify-content-between p-3">
                <div class="col-1">
                    <button id="coord0" class="coordButton col-16"></button>
                </div>
                <div class="col-1">
                    <button id="coord1" class="coordButton col-16"></button>
                </div>
                <div class="col-7"></div>
                @if(ctrl.gameController.state == 1){
                    <div class="alert alert-warning col-md-auto" role="alert">
                        It is your turn @ctrl.getPlayerturn() !
                    </div>
                }else{
                    <div class="alert alert-success col-md-auto" role="alert">
                        It is your turn @ctrl.getPlayerturn() !
                    </div>
                }

            </div>

            <div id="gameBtnPanel">
                <div class="col-4"></div>
                <button id="buyBtn" class="gameButton">Buy</button>
                <button id="combineBtn" class="gameButton">Combine</button>
                <button id="moveBtn" class="gameButton">Move</button>
                <button id="castleBtn" class="gameButton">Castle</button>
                <button id="balanceBtn" class="gameButton">Balance</button>
                <button id="endTurnBtn" class="gameButton">End Turn</button>
                <button id="surrenderBtn" class="gameButton">Surrender</button>
            </div>

            <div id="gameMsg" class="alert alert-info mr-3 ml-3" role="alert">
                @message
            </div>
        </div>

    </body>
</html>

